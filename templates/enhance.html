<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhance CV - Smart Job Assistant</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="bg-shape one"></div>
    <div class="bg-shape two"></div>

    <div class="container">
        <header>
            <div class="logo">SmartJob<span>AI</span></div>
            <p>CV Enhancement Studio</p>
            <div class="menu-icon" onclick="window.location.href='/'">üè†</div>
        </header>

        <main id="app">
            <div class="glass-card full-width">
                <div class="dashboard-header">
                    <h2>Enhance Your Resume</h2>
                    <button class="btn-text" onclick="window.location.href='/'">‚Üê Back to Home</button>
                </div>
                <p class="subtitle">Get a detailed critique on formatting, fonts, spacing, and content.</p>

                <form id="enhance-form">
                    <div class="drop-zone" id="enhance-drop-zone">
                        <p>Drag & Drop your resume here</p>
                        <p class="small">or</p>
                        <button type="button" class="btn-outline"
                            onclick="document.getElementById('enhance-file-input').click()">Browse Files</button>
                        <input type="file" id="enhance-file-input" name="resume" accept=".pdf,.docx" hidden>
                    </div>
                    <div id="enhance-file-name" class="hidden"></div>

                    <button type="submit" class="btn-primary" id="enhance-btn" disabled>Get Suggestions</button>
                </form>

                <div id="enhance-loading" class="loading hidden">
                    <div class="spinner"></div>
                    <p>AI is reviewing your resume structure...</p>
                </div>

                <div id="enhance-results" class="enhance-output hidden">
                    <!-- Suggestions go here -->
                </div>
            </div>
        </main>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        // Inline script for this page specifically to handle the separation
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('enhance-form');
            const fileInput = document.getElementById('enhance-file-input');
            const dropZone = document.getElementById('enhance-drop-zone');
            const fileName = document.getElementById('enhance-file-name');
            const submitBtn = document.getElementById('enhance-btn');
            const loading = document.getElementById('enhance-loading');
            const results = document.getElementById('enhance-results');

            // Drag & Drop
            dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('dragover'); });
            dropZone.addEventListener('dragleave', () => { dropZone.classList.remove('dragover'); });
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                if (e.dataTransfer.files.length) {
                    fileInput.files = e.dataTransfer.files;
                    handleFile();
                }
            });

            fileInput.addEventListener('change', handleFile);

            function handleFile() {
                if (fileInput.files.length) {
                    fileName.textContent = `Selected: ${fileInput.files[0].name}`;
                    fileName.classList.remove('hidden');
                    submitBtn.disabled = false;
                }
            }

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData();
                formData.append('resume', fileInput.files[0]);

                loading.classList.remove('hidden');
                results.classList.add('hidden');
                submitBtn.disabled = true;

                try {
                    const response = await fetch('/enhance-cv', { method: 'POST', body: formData });
                    const data = await response.json();

                    if (data.suggestions) {
                        results.innerHTML = data.suggestions;
                        results.classList.remove('hidden');
                    } else {
                        alert(data.error || 'Error enhancing CV');
                    }
                } catch (err) {
                    alert('An error occurred.');
                } finally {
                    loading.classList.add('hidden');
                    submitBtn.disabled = false;
                }
            });
        });
    </script>
</body>

</html>